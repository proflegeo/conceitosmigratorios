<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocolo M.I.G.R.A.√á.√É.O.</title>
    <style>
        :root { --bg: #050505; --cyan: #00f3ff; --green: #0aff0a; --red: #ff003c; --purple: #bd00ff; --yellow: #f8e71c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { 
            background: var(--bg); color: #eee; font-family: 'Courier New', monospace; 
            margin: 0; height: 100dvh; display: flex; justify-content: center; overflow: hidden; 
        }
        #game { width: 100%; max-width: 600px; height: 100%; padding: 10px; display: flex; flex-direction: column; gap: 10px; position: relative; }
        
        /* HUD */
        .hud { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 5px; min-height: 35px; font-size: 0.9rem; }
        .hud-btn { background: none; border: 1px solid #444; color: #888; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; text-transform: uppercase; }
        
        /* Barra de Progresso */
        .prog-box { width: 100%; height: 4px; background: #222; border-radius: 2px; overflow: hidden; }
        .prog-bar { height: 100%; background: var(--green); width: 0%; transition: width 0.3s; }

        /* Tela Principal */
        .screen { 
            background: #000; border-left: 3px solid var(--purple); padding: 15px; 
            flex-grow: 1; display: flex; flex-direction: column; justify-content: center; 
            align-items: center; text-align: center; border-radius: 5px; position: relative;
        }
        .def { font-size: 1.2rem; line-height: 1.3; font-weight: bold; min-height: 50px; }
        .def::after { content: '‚ñã'; animation: blink 1s infinite; color: var(--purple); font-size: 1rem; margin-left: 5px;}
        .hint { color: var(--yellow); margin-top: 10px; font-size: 0.9rem; border-top: 1px dashed #333; padding-top: 5px; display: none; width: 100%; }
        .show { display: block; animation: fadeIn 0.5s; }

        /* Controles */
        .controls { display: flex; flex-direction: column; gap: 8px; padding-bottom: env(safe-area-inset-bottom); }
        input { 
            background: #111; border: 1px solid #444; color: var(--cyan); padding: 12px; 
            width: 100%; font-size: 18px; border-radius: 5px; text-transform: uppercase; outline: none; text-align: center; font-family: monospace;
        }
        input:focus { border-color: var(--cyan); box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
        .btns { display: flex; gap: 8px; }
        button.action { padding: 12px; flex: 1; border: none; border-radius: 5px; font-weight: bold; font-size: 1rem; cursor: pointer; font-family: monospace;}
        .btn-ok { background: var(--cyan); color: #000; flex: 2; }
        .btn-func { background: #222; color: #fff; border: 1px solid #444; flex: 1; font-size: 0.8rem; }
        .msg { text-align: center; height: 20px; font-weight: bold; font-size: 0.9rem; margin-top: -5px; }

        /* Overlays */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; text-align: center; padding: 20px; }
        .hidden { display: none !important; }
        .btn-start { background: var(--green); color: #000; padding: 15px 40px; font-size: 1.2rem; border-radius: 5px; margin-top: 20px; border: none; font-weight: bold; cursor: pointer; font-family: monospace; text-transform: uppercase; letter-spacing: 2px; }

        /* Relat√≥rio */
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px; margin-bottom: 20px; text-align: left; background: #111; padding: 15px; border: 1px solid #333; }
        .r-item { display: flex; flex-direction: column; }
        .r-label { font-size: 0.7rem; color: #888; text-transform: uppercase; }
        .r-val { font-size: 1.1rem; color: var(--cyan); font-weight: bold; }
        .site-link { margin-top: 20px; color: var(--yellow); text-decoration: none; border-bottom: 1px dashed var(--yellow); padding-bottom: 2px; }

        /* Mini Game Canvas */
        #mg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 40; display: none; }
        .mg-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; text-align: center; width: 100%; pointer-events: none; z-index: 41; text-shadow: 0 2px 0 #000; }

        @keyframes blink { 50% { opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="game">
        <div class="hud">
            <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span> 
            <button class="hud-btn" onclick="init()">Reiniciar</button>
            <span id="skips">‚è≠Ô∏è x5</span>
        </div>
        <div class="prog-box"><div class="prog-bar" id="prog-bar"></div></div>
        
        <div class="screen">
            <div class="def" id="q"></div>
            <div class="hint" id="h"></div>
            <canvas id="mg-canvas"></canvas>
            <div id="mg-msg" class="mg-overlay hidden">
                <h2 style="color:var(--yellow)">ALERTA DE B√îNUS</h2>
                <p>Colete 5 energias para ganhar +1 Vida!</p>
                <p style="font-size:0.8rem; margin-top:10px;">Toque na ESQUERDA ou DIREITA</p>
                <p style="font-size:2rem; margin-top:10px;">üëá</p>
            </div>
        </div>

        <div class="msg" id="msg"></div>

        <div class="controls">
            <input type="text" id="ans" placeholder="DIGITE AQUI..." autocomplete="off">
            <div class="btns">
                <button class="action btn-ok" onclick="check()">ENVIAR</button>
                <button class="action btn-func" onclick="tip()" id="btn-hint">DICA (3)</button>
                <button class="action btn-func" onclick="skip()" id="btn-skip">PULAR</button>
            </div>
        </div>
    </div>

    <div id="start" class="overlay">
        <h1 style="color:var(--cyan); margin-bottom: 10px;">M.I.G.R.A.√á.√É.O.</h1>
        <p style="color: #aaa; font-size: 0.9rem;">Restaurar sistema de navega√ß√£o.</p>
        <button class="btn-start" onclick="init()">INICIAR</button>
    </div>
    <script>
        const db = [
            { t: "Migra√ß√£o", d: "Termo geral para qualquer deslocamento de pessoas pelo espa√ßo geogr√°fico.", h: "Defini√ß√£o geral." },
            { t: "Migra√ß√£o interna", d: "Deslocamento de pessoas dentro das fronteiras de um mesmo pa√≠s.", h: "N√£o sai do pa√≠s." },
            { t: "Migra√ß√£o internacional", d: "Deslocamento de pessoas entre pa√≠ses diferentes.", h: "Entre na√ß√µes." },
            { t: "Emigra√ß√£o", d: "Ato de SAIR do seu local de origem para viver em outro lugar.", h: "Exit / Sa√≠da." },
            { t: "Imigra√ß√£o", d: "Ato de CHEGAR e entrar em um novo local para viver.", h: "In / Entrada." },
            { t: "Migra√ß√£o pendular", d: "Movimento di√°rio de vai e vem (casa-trabalho).", h: "Movimento do p√™ndulo." },
            { t: "Cidade dormit√≥rio", d: "Cidade onde a popula√ß√£o dorme mas trabalha na cidade vizinha.", h: "Apenas para dormir." },
            { t: "Migra√ß√£o de c√©rebros", d: "Sa√≠da de profissionais altamente qualificados para pa√≠ses ricos.", h: "Fuga de cientistas." },
            { t: "Transum√¢ncia", d: "Migra√ß√£o sazonal ligada √† cria√ß√£o de gado ou colheitas.", h: "Pastores e gado." },
            { t: "Refugiado", d: "Pessoa que fugiu por persegui√ß√£o (ra√ßa, religi√£o, pol√≠tica).", h: "Protegido pela ONU." },
            { t: "√äxodo Rural", d: "Migra√ß√£o em massa do campo para a cidade.", h: "Sa√≠da do campo." },
            { t: "Xenofobia", d: "Avers√£o, √≥dio ou preconceito contra estrangeiros.", h: "Medo do estrangeiro." },
            { t: "Gentrifica√ß√£o", d: "Valoriza√ß√£o imobili√°ria que expulsa moradores pobres de um bairro.", h: "Enobrecimento urbano." },
            { t: "Saldo migrat√≥rio", d: "Diferen√ßa matem√°tica entre n√∫mero de imigrantes e emigrantes.", h: "Conta de entrada e sa√≠da." },
            { t: "Ap√°trida", d: "Pessoa sem nacionalidade reconhecida por nenhum pa√≠s.", h: "Sem p√°tria." },
            { t: "Deslocados internos", d: "Fugitivos de conflitos que n√£o cruzaram fronteiras internacionais.", h: "Refugiado dentro do pr√≥prio pa√≠s." },
            { t: "Remessas financeiras", d: "Dinheiro enviado por trabalhadores no exterior para a fam√≠lia.", h: "D√≥lares enviados para casa." },
            { t: "Di√°spora", d: "Dispers√£o de um povo pelo mundo mantendo identidade cultural.", h: "Ex: Judeus." },
            { t: "Sazonal", d: "Deslocamento ligado apenas a esta√ß√µes do ano ou colheitas.", h: "Tempor√°rio por esta√ß√£o." },
            { t: "Naturaliza√ß√£o", d: "Processo jur√≠dico para adquirir nacionalidade de outro pa√≠s.", h: "Virar cidad√£o." },
            { t: "Visto", d: "Autoriza√ß√£o no passaporte para entrar em um pa√≠s.", h: "Carimbo no passaporte." },
            { t: "Deportar", d: "Ato do Estado de enviar for√ßadamente estrangeiro de volta.", h: "Expuls√£o." },
            { t: "Fatores de repuls√£o", d: "Motivos negativos que empurram a pessoa para fora.", h: "Guerra, fome." },
            { t: "Fatores de atra√ß√£o", d: "Motivos positivos que puxam o migrante.", h: "Emprego, paz." },
            { t: "Asilo", d: "Prote√ß√£o jur√≠dica pedida a outro governo por persegui√ß√£o pol√≠tica.", h: "Prote√ß√£o pol√≠tica." },
            { t: "N√¥made digital", d: "Profissional que usa internet para trabalhar de qualquer lugar.", h: "Trabalho remoto." },
            { t: "Censo demogr√°fico", d: "Pesquisa oficial do governo para contar a popula√ß√£o.", h: "IBGE conta o povo." },
            { t: "Migra√ß√£o intermunicipal", d: "Mudan√ßa de resid√™ncia de uma cidade para outra.", h: "Entre munic√≠pios." },
            { t: "Migra√ß√£o interestadual", d: "Mudan√ßa de resid√™ncia de um estado para outro.", h: "Entre estados." },
            { t: "Expatriado", d: "Profissional enviado pela empresa para trabalhar no exterior.", h: "Transferido pela empresa." },
            { t: "Coyote", d: "Atravessador pago para guiar imigrantes ilegais.", h: "Guia ilegal." },
            { t: "Tr√°fico de pessoas", d: "Recrutamento enganoso/for√ßado de pessoas para explora√ß√£o.", h: "Crime contra liberdade." }
        ];

        let st = { 
            q: [], c: null, lives: 5, hints: 3, skips: 5, 
            score: 0, errors: 0, streak: 0, maxStreak: 0, 
            startTime: 0, answeredCount: 0 
        };
        let typeInterval;

        function init() {
            st.q = [...db].sort(() => Math.random() - 0.5); 
            st.lives = 5; st.hints = 3; st.skips = 5;
            st.score = 0; st.errors = 0; st.streak = 0; st.maxStreak = 0; st.answeredCount = 0;
            st.startTime = Date.now();
            
            document.getElementById('start').classList.add('hidden');
            updateHUD();
            next();
        }

        function typeWriter(text) {
            const el = document.getElementById('q');
            el.innerText = ""; clearInterval(typeInterval);
            let i = 0;
            typeInterval = setInterval(() => {
                el.innerText += text.charAt(i); i++;
                if (i >= text.length) clearInterval(typeInterval);
            }, 25);
        }

        function next() {
            // Verifica Mini Game
            if (st.answeredCount === 13 || st.answeredCount === 31) {
                st.answeredCount++; // Incrementa para n√£o travar no loop
                startMiniGame();
                return;
            }

            if (!st.q.length || st.lives <= 0) return end();
            
            st.c = st.q.shift(); // Pega o primeiro
            typeWriter(st.c.d);

            document.getElementById('h').classList.remove('show');
            document.getElementById('ans').value = '';
            document.getElementById('msg').innerText = '';
            document.getElementById('ans').focus();
        }

        function check() {
            let v = document.getElementById('ans').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
            let r = st.c.t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
            let alt = st.c.a ? st.c.a.map(x => x.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim()) : [];

            const msgEl = document.getElementById('msg');

            if (v === r || alt.includes(v)) {
                st.score++; st.answeredCount++; st.streak++;
                if (st.streak > st.maxStreak) st.maxStreak = st.streak;
                
                msgEl.innerText = "‚úÖ CORRETO! " + (st.streak > 1 ? "COMBO x"+st.streak : "");
                msgEl.style.color = "#0aff0a";
                updateProgress();
                setTimeout(next, 1000);
            } else {
                st.lives--; st.errors++; st.streak = 0;
                msgEl.innerText = "‚ùå ERA: " + st.c.t.toUpperCase();
                msgEl.style.color = "#ff003c";
                
                // L√ìGICA DE REPETI√á√ÉO: Joga para o final da fila para aparecer depois
                st.q.push(st.c); 
                
                updateHUD();
                setTimeout(next, 2500);
            }
        }

        function skip() {
            if (st.skips > 0) {
                st.skips--;
                st.q.push(st.c); // Joga pro final
                document.getElementById('msg').innerText = "‚è≠Ô∏è PULOU";
                document.getElementById('msg').style.color = "orange";
                updateHUD();
                setTimeout(next, 500);
            }
        }

        function tip() {
            if (st.hints > 0) {
                st.hints--;
                document.getElementById('h').innerText = "üí° " + st.c.h;
                document.getElementById('h').classList.add('show');
                updateHUD();
            }
        }

        function updateHUD() {
            document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(st.lives);
            document.getElementById('skips').innerText = "‚è≠Ô∏è x" + st.skips;
            document.getElementById('btn-hint').innerText = "DICA ("+st.hints+")";
            document.getElementById('btn-skip').innerText = "PULAR ("+st.skips+")";
        }

        function updateProgress() {
            // Progresso baseado no DB original (32 perguntas)
            let pct = Math.min((st.score / 32) * 100, 100);
            document.getElementById('prog-bar').style.width = pct + "%";
        }

        // --- MINI GAME SYSTEM ---
        let mg = { active: false, x: 0, items: [], score: 0, ctx: null, w: 0, h: 0 };
        
        function startMiniGame() {
            mg.active = true; mg.score = 0; mg.items = [];
            const cvs = document.getElementById('mg-canvas');
            const msg = document.getElementById('mg-msg');
            cvs.style.display = 'block'; msg.classList.remove('hidden');
            
            // Setup Canvas
            mg.ctx = cvs.getContext('2d');
            mg.w = cvs.width = cvs.offsetWidth;
            mg.h = cvs.height = cvs.offsetHeight;
            mg.x = mg.w / 2;

            // Espera 2s para come√ßar
            setTimeout(() => {
                msg.classList.add('hidden');
                loopMiniGame();
                spawnItem();
            }, 3000);
        }

        function spawnItem() {
            if (!mg.active) return;
            mg.items.push({ x: Math.random() * (mg.w - 20), y: -20, speed: 3 + Math.random() * 2 });
            if (mg.score < 5) setTimeout(spawnItem, 800);
        }

        function loopMiniGame() {
            if (!mg.active) return;
            mg.ctx.clearRect(0, 0, mg.w, mg.h);
            
            // Desenha Jogador (Nave)
            mg.ctx.fillStyle = '#00f3ff';
            mg.ctx.fillRect(mg.x - 20, mg.h - 30, 40, 10);
            mg.ctx.beginPath(); mg.ctx.moveTo(mg.x, mg.h-40); mg.ctx.lineTo(mg.x-10, mg.h-30); mg.ctx.lineTo(mg.x+10, mg.h-30); mg.ctx.fill();

            // Desenha Items (Energia)
            mg.ctx.fillStyle = '#0aff0a';
            for (let i = 0; i < mg.items.length; i++) {
                let it = mg.items[i];
                it.y += it.speed;
                mg.ctx.beginPath(); mg.ctx.arc(it.x, it.y, 8, 0, Math.PI*2); mg.ctx.fill();

                // Colis√£o
                if (it.y > mg.h - 40 && it.y < mg.h - 10 && it.x > mg.x - 25 && it.x < mg.x + 25) {
                    mg.score++; mg.items.splice(i, 1); i--;
                } else if (it.y > mg.h) {
                    mg.items.splice(i, 1); i--; // Perdeu item
                }
            }

            // HUD do Minigame
            mg.ctx.fillStyle = '#fff'; mg.ctx.font = '20px monospace';
            mg.ctx.fillText("COLETE: " + mg.score + "/5", 10, 30);

            if (mg.score >= 5) {
                endMiniGame(true);
            } else {
                requestAnimationFrame(loopMiniGame);
            }
        }

        function endMiniGame(win) {
            mg.active = false;
            const msg = document.getElementById('mg-msg');
            msg.innerHTML = "<h2 style='color:#0aff0a'>B√îNUS COMPLETADO!</h2><p>+1 VIDA EXTRA</p>";
            msg.classList.remove('hidden');
            
            if (win) st.lives++;
            updateHUD();

            setTimeout(() => {
                document.getElementById('mg-canvas').style.display = 'none';
                msg.classList.add('hidden');
                next(); // Volta pro quiz
            }, 2000);
        }

        // Controles do Mini Game (Toque)
        document.getElementById('mg-canvas').addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = e.target.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            if (x < mg.w / 2) mg.x -= 40; else mg.x += 40;
            // Limites
            if (mg.x < 20) mg.x = 20; if (mg.x > mg.w - 20) mg.x = mg.w - 20;
        });

        // Controles do Mini Game (Mouse/Setas para teste PC)
        document.addEventListener('keydown', (e) => {
            if (!mg.active) return;
            if (e.key === "ArrowLeft") mg.x -= 40;
            if (e.key === "ArrowRight") mg.x += 40;
            if (mg.x < 20) mg.x = 20; if (mg.x > mg.w - 20) mg.x = mg.w - 20;
        });

        function end() {
            const time = Math.floor((Date.now() - st.startTime) / 1000);
            const m = Math.floor(time / 60).toString().padStart(2, '0');
            const s = (time % 60).toString().padStart(2, '0');
            const total = st.score + st.errors;
            const acc = total === 0 ? 0 : Math.round((st.score / total) * 100);
            const win = st.lives > 0;

            document.getElementById('start').classList.remove('hidden');
            document.getElementById('start').innerHTML = `
                <h1 style="color: ${win ? '#0aff0a' : '#ff003c'}; font-size: 2rem;">
                    ${win ? 'MISS√ÉO CUMPRIDA' : 'FALHA NO SISTEMA'}
                </h1>
                
                <div class="report-grid">
                    <div class="r-item"><span class="r-label">Acertos</span><span class="r-val">${st.score}</span></div>
                    <div class="r-item"><span class="r-label">Erros</span><span class="r-val" style="color:#ff003c">${st.errors}</span></div>
                    <div class="r-item"><span class="r-label">Precis√£o</span><span class="r-val">${acc}%</span></div>
                    <div class="r-item"><span class="r-label">Tempo</span><span class="r-val">${m}:${s}</span></div>
                    <div class="r-item"><span class="r-label">Maior Combo</span><span class="r-val" style="color:#bd00ff">${st.maxStreak}</span></div>
                    <div class="r-item"><span class="r-label">Status</span><span class="r-val">${win ? 'RESGATADO' : 'PERDIDO'}</span></div>
                </div>

                <a href="https://legeo.com.br" target="_blank" class="site-link">Mais conte√∫dos em legeo.com.br</a>
                <button class="btn-start" onclick="location.reload()">NOVA MISS√ÉO</button>
            `;
        }

        document.getElementById('ans').addEventListener("keypress", (e) => {
            if (e.key === "Enter") check();
        });
    </script>
</body>
</html>
